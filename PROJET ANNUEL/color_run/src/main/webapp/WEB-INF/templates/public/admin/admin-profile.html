<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profil Administrateur - Color Run</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="../../assets/css/style.css">
</head>
<body class="bg-gray-100">
    <!-- Navigation Desktop -->
    <nav class="bg-white shadow-lg desktop-nav">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <a href="admin-dashboard.html" class="text-2xl font-bold text-purple-600">Color Run</a>
                </div>
                <div class="hidden md:flex items-center space-x-4">
                    <a href="admin-dashboard.html" class="text-gray-700 hover:text-purple-600">Tableau de bord</a>
                    <a href="admin-races.html" class="text-gray-700 hover:text-purple-600">Courses</a>
                    <a href="adminUsers.html" class="text-gray-700 hover:text-purple-600">Utilisateurs</a>
                    <a href="admin-organizers.html" class="text-gray-700 hover:text-purple-600">Organisateurs</a>
                    <div class="flex items-center">
                        <div class="relative group">
                            <div class="w-8 h-8 rounded-full overflow-hidden bg-gray-200 flex-shrink-0">
                                <img src="../../assets/images/default-avatar.png" alt="Photo de profil" class="w-full h-full object-cover">
                            </div>
                            <div class="absolute right-0 mt-2 w-56 bg-white rounded-lg shadow-lg py-2 transform opacity-0 scale-95 invisible group-hover:opacity-100 group-hover:scale-100 group-hover:visible transition-all duration-200 origin-top-right z-50">
                                <a href="admin-profile.html" class="flex items-center px-4 py-3 text-purple-600 bg-purple-50">
                                    <i class="fas fa-user-circle w-5 h-5 mr-3"></i>
                                    <span class="font-medium">Mon profil</span>
                                </a>
                                <div class="border-t border-gray-100 my-2"></div>
                                <button class="w-full flex items-center px-4 py-3 text-red-600 hover:bg-red-50 transition-colors duration-200 logout-button">
                                    <i class="fas fa-sign-out-alt w-5 h-5 mr-3"></i>
                                    <span class="font-medium">Déconnexion</span>
                                </button>
                            </div>
                        </div>
                        <span class="font-medium user-name ml-2"></span>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Mobile Navigation -->
    <nav class="bg-white shadow-lg fixed bottom-0 left-0 right-0 md:hidden z-50">
        <div class="flex justify-around items-center h-16">
            <a href="admin-dashboard.html" class="flex flex-col items-center text-gray-600">
                <i class="fas fa-tachometer-alt text-xl"></i>
                <span class="text-xs mt-1">Dashboard</span>
            </a>
            <a href="admin-races.html" class="flex flex-col items-center text-gray-600">
                <i class="fas fa-running text-xl"></i>
                <span class="text-xs mt-1">Courses</span>
            </a>
            <a href="adminUsers.html" class="flex flex-col items-center text-gray-600">
                <i class="fas fa-users text-xl"></i>
                <span class="text-xs mt-1">Utilisateurs</span>
            </a>
            <a href="admin-organizers.html" class="flex flex-col items-center text-gray-600">
                <i class="fas fa-building text-xl"></i>
                <span class="text-xs mt-1">Organisateurs</span>
            </a>
            <a href="admin-profile.html" class="flex flex-col items-center text-purple-600">
                <i class="fas fa-user-circle text-xl"></i>
                <span class="text-xs mt-1">Profil</span>
            </a>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 py-8 mb-20 md:mb-8">
        <!-- Photo et informations basiques -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-8">
            <div class="text-center mb-6">
                <div class="relative inline-block">
                    <img src="../../assets/images/default-avatar.png" alt="Photo de profil" class="w-32 h-32 rounded-full mx-auto">
                    <button class="absolute bottom-0 right-0 bg-purple-600 text-white p-2 rounded-full hover:bg-purple-700" title="Modifier la photo de profil">
                        <i class="fas fa-camera"></i>
                    </button>
                </div>
                <h2 class="text-xl font-semibold mt-4 user-name"></h2>
                <p class="text-gray-600">Administrateur</p>
            </div>
            <div class="border-t border-gray-200 pt-4">
                <div class="text-sm text-gray-600 text-center">
                    <p class="mb-2 user-email"><i class="fas fa-envelope mr-2"></i></p>
                    <p class="mb-2 user-date"><i class="fas fa-calendar mr-2"></i></p>
                    <p class="mb-4"><i class="fas fa-shield-alt mr-2"></i>Accès complet</p>
                </div>
            </div>
        </div>

        <!-- Informations du profil -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-8">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-semibold">Informations du profil</h2>
                <button class="text-purple-600 hover:text-purple-700" id="edit-profile-btn">
                    <i class="fas fa-edit"></i> Modifier
                </button>
            </div>
            <form id="admin-profile-form" class="space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="name" class="block text-sm font-medium text-gray-700">Nom</label>
                        <input type="text" id="name" name="name" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-purple-500 focus:ring-purple-500" value="" disabled placeholder="Votre nom">
                    </div>
                    <div>
                        <label for="email" class="block text-sm font-medium text-gray-700">Email</label>
                        <input type="email" id="email" name="email" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-purple-500 focus:ring-purple-500" value="" disabled placeholder="Votre email">
                    </div>
                    <div>
                        <label for="role" class="block text-sm font-medium text-gray-700">Rôle</label>
                        <input type="text" id="role" name="role" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-purple-500 focus:ring-purple-500" value="Administrateur" disabled placeholder="Votre rôle">
                    </div>
                    <div>
                        <label for="created_at" class="block text-sm font-medium text-gray-700">Date de création du compte</label>
                        <input type="text" id="created_at" name="created_at" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-purple-500 focus:ring-purple-500" value="" disabled placeholder="Date de création">
                    </div>
                </div>
            </form>
        </div>

        <!-- Sécurité -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-8">
            <h2 class="text-xl font-semibold mb-6">Sécurité</h2>
            <form id="security-form" class="space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="current-password" class="block text-sm font-medium text-gray-700">Mot de passe actuel</label>
                        <input type="password" id="current-password" name="current-password" 
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-purple-500 focus:ring-purple-500"
                            placeholder="Entrez votre mot de passe actuel">
                    </div>
                    <div>
                        <label for="new-password" class="block text-sm font-medium text-gray-700">Nouveau mot de passe</label>
                        <input type="password" id="new-password" name="new-password" 
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-purple-500 focus:ring-purple-500"
                            placeholder="Entrez votre nouveau mot de passe">
                    </div>
                </div>
                <div class="flex justify-end">
                    <button type="submit" class="bg-purple-600 text-white px-6 py-2 rounded-md hover:bg-purple-700">
                        Mettre à jour le mot de passe
                    </button>
                </div>
            </form>
        </div>

        <!-- Statistiques d'administration -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold">Courses gérées</h3>
                    <i class="fas fa-flag-checkered text-purple-600 text-xl"></i>
                </div>
                <p class="text-3xl font-bold text-purple-600">15</p>
                <p class="text-sm text-gray-600 mt-2">Derniers 30 jours</p>
            </div>
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold">Utilisateurs actifs</h3>
                    <i class="fas fa-users text-purple-600 text-xl"></i>
                </div>
                <p class="text-3xl font-bold text-purple-600">250</p>
                <p class="text-sm text-gray-600 mt-2">Total des utilisateurs</p>
            </div>
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold">Actions récentes</h3>
                    <i class="fas fa-history text-purple-600 text-xl"></i>
                </div>
                <p class="text-3xl font-bold text-purple-600">45</p>
                <p class="text-sm text-gray-600 mt-2">Cette semaine</p>
            </div>
        </div>

        <!-- Bouton de déconnexion -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <button class="w-full bg-red-600 text-white px-4 py-3 rounded-md hover:bg-red-700 text-center logout-button">
                <i class="fas fa-sign-out-alt mr-2"></i>
                Déconnexion
            </button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const editProfileBtn = document.getElementById('edit-profile-btn');
            const form = document.getElementById('admin-profile-form');
            const inputs = form.querySelectorAll('input');
            const photoBtn = document.querySelector('.fa-camera').parentElement;
            const profileImage = document.querySelector('.w-32.h-32');
            
            // Charger les données de l'admin depuis le localStorage
            const adminData = JSON.parse(localStorage.getItem('adminData')) || {
                name: '',
                email: '',
                role: 'Administrateur',
                createdAt: '',
                avatar: '../../assets/images/default-avatar.png'
            };

            // Mettre à jour tous les éléments affichant le nom et l'email
            document.querySelectorAll('.user-name').forEach(el => el.textContent = adminData.name);
            document.querySelectorAll('.user-email').forEach(el => el.innerHTML = `<i class="fas fa-envelope mr-2"></i>${adminData.email}`);
            document.querySelector('.user-date').innerHTML = `<i class="fas fa-calendar mr-2"></i>Membre depuis ${adminData.createdAt}`;

            // Remplir le formulaire avec les données
            inputs.forEach(input => {
                if (adminData[input.name]) {
                    input.value = adminData[input.name];
                }
            });

            // Mettre à jour l'avatar si disponible
            if (adminData.avatar) {
                profileImage.src = adminData.avatar;
                document.querySelectorAll('img[alt="Photo de profil"]').forEach(img => {
                    img.src = adminData.avatar;
                });
            }
            
            editProfileBtn.addEventListener('click', function() {
                const isEditing = editProfileBtn.classList.contains('editing');
                
                if (isEditing) {
                    // Sauvegarder les modifications
                    const formData = {};
                    inputs.forEach(input => {
                        if (input.name !== 'role' && input.name !== 'created_at') {
                            formData[input.name] = input.value;
                        }
                    });
                    
                    // Fusionner avec les données existantes
                    const updatedData = { ...adminData, ...formData };
                    localStorage.setItem('adminData', JSON.stringify(updatedData));
                    
                    editProfileBtn.innerHTML = '<i class="fas fa-edit"></i> Modifier';
                    editProfileBtn.classList.remove('editing');
                    inputs.forEach(input => {
                        if (input.name !== 'role' && input.name !== 'created_at') {
                            input.disabled = true;
                        }
                    });
                    
                    // Mettre à jour l'affichage de la sidebar et de la navigation
                    document.querySelectorAll('.user-name').forEach(el => el.textContent = formData.name);
                    document.querySelectorAll('.user-email').forEach(el => el.innerHTML = `<i class="fas fa-envelope mr-2"></i>${formData.email}`);
                    
                    // Afficher un message de succès
                    showAlert('Profil mis à jour avec succès !', 'success');
                } else {
                    // Activer le mode édition
                    editProfileBtn.innerHTML = '<i class="fas fa-save"></i> Enregistrer';
                    editProfileBtn.classList.add('editing');
                    inputs.forEach(input => {
                        if (input.name !== 'role' && input.name !== 'created_at') {
                            input.disabled = false;
                        }
                    });
                }
            });

            // Gestion de l'upload de photo
            photoBtn.addEventListener('click', function() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = 'image/*';
                input.style.display = 'none';
                document.body.appendChild(input);

                input.click();

                input.addEventListener('change', function() {
                    const file = this.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            const imageUrl = e.target.result;
                            profileImage.src = imageUrl;
                            document.querySelectorAll('img[alt="Photo de profil"]').forEach(img => {
                                img.src = imageUrl;
                            });
                            
                            // Sauvegarder l'URL de l'image dans le localStorage
                            const updatedData = { ...adminData, avatar: imageUrl };
                            localStorage.setItem('adminData', JSON.stringify(updatedData));
                            
                            showAlert('Photo de profil mise à jour avec succès !', 'success');
                        };
                        reader.readAsDataURL(file);
                    }
                });
            });

            // Gestion de la déconnexion
            document.querySelectorAll('.logout-button').forEach(button => {
                button.addEventListener('click', function() {
                    localStorage.removeItem('adminData');
                    window.location.href = '../login.html';
                });
            });
        });
    </script>
</body>
</html> 